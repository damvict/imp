{% extends "base.html" %}
{% block title %}Outstanding Report{% endblock %}

{% block content %}
<div class="container-fluid" style="background:#F9FAFB; min-height:100vh;">

  <!-- ================= HEADER ================= -->
  <div class="d-flex align-items-center px-3"
       style="background:#1E3A8A; min-height:60px;">
    <a href="javascript:history.back()"
       class="btn btn-link text-white text-decoration-none me-2">
      ‚Üê
    </a>
    <h5 class="flex-grow-1 text-center text-white fw-bold mb-0">
      Outstanding Report
    </h5>
    <div style="width:44px;"></div>
  </div>

  <!-- ================= FILTER FORM ================= -->
  <div class="container py-3">
    <form method="post">
      {% csrf_token %}

      <div class="row g-3">

        <!-- Company -->
        <div class="col-md-4">
          <label class="form-label fw-bold">Company</label>
          <select name="company_id" class="form-select">
            <option value="">All Companies</option>
            {% for c in companies %}
              <option value="{{ c.id }}"
                {% if selected_company|stringformat:"s" == c.id|stringformat:"s" %}
                  selected
                {% endif %}
              >
                {{ c.name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- Document Type -->
        <div class="col-md-4">
          <label class="form-label fw-bold">Document Type</label>
          <select name="doc_type" class="form-select">
            {% for t in doc_types %}
              <option value="{{ t }}"
                {% if selected_doc_type == t %}selected{% endif %}
              >
                {{ t }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- As At Date -->
        <div class="col-md-4">
          <label class="form-label fw-bold">As at Date</label>
          <input type="date"
                 name="date"
                 class="form-control"
                 value="{{ as_at }}"
                 required>
        </div>

      </div>

      <div class="mt-3">
        <button class="btn btn-primary w-100">
          üîç Generate Report
        </button>
      </div>
    </form>
  </div>

  <!-- ================= RESULTS TABLE ================= -->
  <div class="container pb-4">

    {% if results %}
      <div class="table-responsive">
        <table class="table table-bordered table-sm align-middle">
          <thead class="table-primary text-center">
            <tr>
              <th>#</th>
              <th>Company</th>
              <th>Doc Type</th>
              <th>Reference No</th>
              <th class="text-end">Amount</th>
              <th class="text-end">Outstanding</th>
            </tr>
          </thead>
          <tbody>
            {% for item in results %}
              <tr>
                <td class="text-center">{{ forloop.counter }}</td>
                <td>{{ item.company }}</td>
                <td class="text-center">{{ item.doc_type }}</td>
                <td>{{ item.reference_number }}</td>
                <td class="text-end">
                  {{ item.amount|floatformat:2 }}
                </td>
                <td class="text-end fw-bold text-danger">
                  {{ item.balance|floatformat:2 }}
                </td>
              </tr>
            {% endfor %}
          </tbody>

          {% if total_amount or total_balance %}
          <tfoot class="table-light">
            <tr>
              <th colspan="4" class="text-end">TOTAL</th>
              <th class="text-end">
                {{ total_amount|floatformat:2 }}
              </th>
              <th class="text-end text-danger">
                {{ total_balance|floatformat:2 }}
              </th>
            </tr>
          </tfoot>
          {% endif %}
        </table>
      </div>

    {% elif as_at %}
      <p class="text-center text-muted mt-4">
        No outstanding records found
      </p>
    {% endif %}

  </div>

</div>
{% endblock %}
