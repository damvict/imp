{% extends 'base.html' %}
{% block content %}
<style>
/* Base table styles */
.table {
    border-collapse: collapse;
    width: 100%;
    table-layout: auto; /* better responsiveness */
}
.table th, .table td {
    padding: 0.4rem 0.6rem;
    vertical-align: middle;
    white-space: nowrap;
}
.table tr {
    height: 20px;
}
.table-striped tbody tr:nth-of-type(odd) {
    background-color: #beccc4;
}
.table-hover tbody tr:hover {
    background-color: #e9eff5;
}
.table thead th {
    background-color: #10243a;
    color: white;
    padding: 0.5rem;
    text-align: left;
}

/* DataTables adjustments */
.dataTables_wrapper .dataTables_filter,
.dataTables_wrapper .dt-buttons {
    margin-bottom: 0.75rem;
}

/* Form adjustments */
.responsive-form input[type="date"],
.responsive-form input[type="checkbox"],
.responsive-form button {
    display: block;
    width: 100%;
    margin-bottom: 0.3rem;
}

/* Badge adjustments */
.badge {
    font-size: 0.85rem;
    padding: 0.25rem 0.5rem;
}

/* Mobile styles */
@media (max-width: 768px) {
    .table th, .table td {
        font-size: 0.8rem;
        padding: 0.25rem 0.4rem;
    }
    .btn-sm {
        font-size: 0.7rem;
        padding: 0.2rem 0.4rem;
    }
    .responsive-form input,
    .responsive-form button {
        font-size: 0.75rem;
    }
}
</style>

<div class="container mt-5">
    <a href="{% url 'shipment_create' %}" class="btn btn-light text-primary fw-bold btn-sm mb-3">
        <i class="fas fa-plus-circle"></i> New Shipment
    </a>

    <div class="card-body p-4">
        <!-- Responsive wrapper -->
        <div class="table-responsive">
            <table id="datatable-buttons" class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Shipment No</th>
                        <th>Purchase Order</th>
                        <th>Order Date</th>
                        <th>Item Category</th>
                        <th>Expected Arrival</th>
                        <th>Status</th>
                        <th>Actions</th>
                        {% if is_bank_controller %}
                        <th>Bank Doc.Received</th>
                        {% endif %}
                         {% if is_bank_Manager %}
                        <th>Payment Done</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for shipment in shipments %}
                    <tr>
                        <td>{{ shipment.shipment.id }}</td>
                        <td>{{ shipment.shipment.purchase_order_no }}</td>
                        <td>{{ shipment.shipment.order_date }}</td>
                        <td>{{ shipment.item_category.item_name }}</td>
                        <td>{{ shipment.shipment.expected_arrival_date }}</td>
                        <td>
                            <span class="badge" style="background-color: {{ shipment.status.color_code }};">
                                {{ shipment.status.status_name }}
                            </span>
                        </td>
                        <td>
                            <a href="{% url 'shipment_edit' shipment.shipment.pk %}" class="text-primary me-2">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="{% url 'shipment_delete' shipment.shipment.pk %}" class="text-danger"
                               onclick="return confirm('Are you sure you want to delete this shipment?');">
                                <i class="fas fa-trash-alt"></i>
                            </a>
                        </td>
                        {% if is_bank_controller %}
                        <td>
                            <form method="post" action="{% url 'bank_controller_update' shipment.shipment.id %}" class="responsive-form">
                                {% csrf_token %}
                                <input type="date" name="send_date" value="{{ shipment.shipment.send_date|date:'Y-m-d' }}">
                                <input type="checkbox" name="send_to_clearing_agent" {% if shipment.shipment.send_to_clearing_agent %}checked{% endif %}>
                                <button type="submit" class="btn btn-primary btn-sm">Update</button>
                            </form>
                        </td>
                        {% endif %}

                         {% if is_bank_Manager %}
                        <td>
                            <form method="post" action="{% url 'bank_manager_update' shipment.shipment.id %}" class="responsive-form">
                                {% csrf_token %}
                                <input type="date" name="send_date" value="{{ shipment.shipment.send_date|date:'Y-m-d' }}">
                                <input type="checkbox" name="payment markerd" {% if shipment.shipment.payment_marked_date %}checked{% endif %}>
                                <button type="submit" class="btn btn-primary btn-sm">Update</button>
                            </form>
                        </td>
                        {% endif %}
                        
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="{% if is_bank_controller %}8{% else %}7{% endif %}" class="text-center">No shipments found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
